"use strict";var WPFormsSignatures=window.WPFormsSignatures||function(c,t,i){var r={config:{windowWidth:!1,pixelRatio:Math.max(t.devicePixelRatio||1,1),watching:!1,watchingRate:300},getCanvas:function(t){t=t.get(0);return t.width=t.offsetWidth*r.config.pixelRatio,t.height=t.offsetHeight*r.config.pixelRatio,t.getContext("2d").scale(r.config.pixelRatio,r.config.pixelRatio),t},cropCanvas:function(t){for(var a,i=c.createElement("canvas"),n=i.getContext("2d"),e=(i.width=t.width,i.height=t.height,n.drawImage(t,0,0),i.width),r=i.height,o={x:[],y:[]},s=n.getImageData(0,0,i.width,i.height),g=0;g<r;g++)for(a=0;a<e;a++)0<s.data[3+4*(g*e+a)]&&(o.x.push(a),o.y.push(g));return o.x.sort(function(t,a){return t-a}),o.y.sort(function(t,a){return t-a}),t=o.x.length-1,e=o.x[t]-o.x[0],r=o.y[t]-o.y[0],t=n.getImageData(o.x[0],o.y[0],e,r),i.width=e,i.height=r,n.putImageData(t,0,0),i.toDataURL()},watchSignatures:function(){var a=!0;i(".wpforms-signature-canvas").each(function(){var t=i(this);t.hasClass("loaded")||(a=!1,t.is(":hidden")||n.loadSignature(t))}),a&&(clearInterval(r.config.watching),r.config.watching=!1)}},n={init:function(){i(c).on("wpformsReady",n.ready)},ready:function(){r.config.windowWidth=i(t).width(),n.loadSignatures(),i(c).on("click",".wpforms-signature-clear",function(t){t.preventDefault(),n.resetSignature(i(this).parent().find(".wpforms-signature-canvas"),!0)}),i(t).resize(n.resetSignatures),r.config.watching=setInterval(r.watchSignatures,r.config.watchingRate)},loadSignatures:function(){i(".wpforms-signature-canvas").each(function(){n.loadSignature(i(this))})},loadSignature:function(t){var a=t.closest(".wpforms-field-signature").find(".wpforms-signature-input"),i=r.getCanvas(t),n=t.data("color");t.is(":hidden")||(t.addClass("loaded"),n=new SignaturePad(i,{penColor:n,onEnd:function(){a.val(r.cropCanvas(i)).trigger("input change").valid()}}),t.data("signaturePad",n))},resetSignatures:function(){r.config.windowWidth!==i(t).width()&&i(".wpforms-signature-canvas").each(function(){n.resetSignature(i(this),!1)})},resetSignature:function(t,a){var i=t.closest(".wpforms-field-signature").find(".wpforms-signature-input"),n=t.data("signaturePad"),e=n.toDataURL("image/svg+xml");a?n.clear():(r.getCanvas(t),n.fromDataURL(e)),i.trigger("input change"),t.is(":hidden")&&(t.removeClass("loaded"),r.config.watching||(r.config.watching=setInterval(r.watchSignatures,r.config.watchingRate)))}};return n}(document,window,jQuery);WPFormsSignatures.init();